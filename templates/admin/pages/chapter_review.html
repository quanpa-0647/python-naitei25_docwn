{% extends 'base_admin.html' %}
{% load static %}
{% load i18n %}
{% load chapter_extras %}
{% load message_tags %}

{% block title %}{% trans "Xét duyệt chương" %}: {{ chapter.title }}{% endblock %}

{% block extra_css %}
<link href="{% static 'admin/css/chapter_review.css' %}" rel="stylesheet">
<link href="{% static 'admin/css/fontawesome.all.min.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container">
    <!-- Chapter Header Card -->
    {% include "admin/includes/chapter_review_header.html" %}
    
    {% comment %} {% if messages %}
        <div class="messages">
            {% show_messages messages %}
        </div>
    {% endif %} {% endcomment %}
    
    <!-- Rejection Reason -->
    {% if chapter.rejected_reason %}
    <div class="rejection-card">
        <div class="rejection-content">
            <i class="fas fa-exclamation-triangle"></i>
            <div>
                <h3 class="rejection-title">{% trans "Lý do từ chối" %}</h3>
                <p class="rejection-text">{{ chapter.rejected_reason }}</p>
            </div>
        </div>
    </div>
    {% endif %}
    
    <div class="grid xl:grid-cols-4 gap-8">
        <!-- Nội dung chương -->
        {% include "admin/includes/chapter_review_content.html" %}
        
        <!-- Sidebar -->
        {% if not chapter.approved and unapproved_chapter_url %}
            <div class="sidebar-warning">
                <div class="warning-card">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <h3>{% trans "Thông báo" %}</h3>
                        <p>{% trans "Bạn cần phải duyệt chương trước đó trước khi xét duyệt chương này." %}</p>
                        <a href="{{ unapproved_chapter_url }}" class="btn btn-primary">
                            {% trans "Đi đến chương chưa duyệt" %}
                        </a>
                    </div>
                </div>
            </div>
        {% elif not chapter.approved and not chapter.rejected_reason %}
            {% include "admin/includes/chapter_review_sidebar.html" %}
        {% endif %}
    </div>
</div>

<!-- Confirm Dialog Template -->
<div id="confirmDialog" class="confirm-dialog" style="display: none;">
    <div class="confirm-content">
        <h3 class="confirm-title" id="confirmTitle"></h3>
        <p class="confirm-message" id="confirmMessage"></p>
        <div class="confirm-actions">
            <button type="button" class="btn btn-secondary" id="confirmCancel">
                {% trans "Hủy" %}
            </button>
            <button type="button" class="btn" id="confirmOk">
                {% trans "Xác nhận" %}
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
window.translations = {
    confirmApprove: "{% trans 'Xác nhận duyệt chương' %}",
    confirmApproveMessage: "{% trans 'Bạn có chắc chắn muốn duyệt chương này? Hành động này không thể hoàn tác.' %}",
    confirmReject: "{% trans 'Xác nhận từ chối' %}",
    confirmRejectMessage: "{% trans 'Bạn có chắc chắn muốn từ chối chương này?' %}",
    approve: "{% trans 'Duyệt chương' %}",
    reject: "{% trans 'Từ chối chương' %}",
    cancel: "{% trans 'Huỷ' %}",
    processing: "{% trans 'Đang xử lý...' %}",
    reasonRequired: "{% trans 'Vui lòng nhập lý do từ chối.' %}"
};
</script>
<script src="{% static 'admin/js/chapter_review.js' %}"></script>
{% endblock %}
